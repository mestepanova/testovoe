# Описание

## Запуск проекта

```
docker-compose up
```

## Makefile

Запуск unit-тестов

```
make test-unit
```

Запуск интеграционных тестов

```
make test-int
```

Запуск статического анализа кода с помощью golangci-lint

```
make lint
```

Запуск линтера с автоисправлением и форматированием

```
make fmt
```
## Реализованные дополнительные задания

### 1. Эндпоинт статистики

`GET /stats/get`

Возвращает:
- pull_requests_stats - список статистик по каждому pull request
    - pull_request_id - идентификатор pull request
    - assignments_count - суммарное число назначений ревьюверов у этого pull request
- user_stats - список статистик по каждому пользователю
    - user_id - идентификатор пользователя
    - assignments_count - суммарное число назначений ревьювером у этого пользователя
    - status_changes_count - суммарное число изменений статуса is_active у этого пользователя

### 2. Интеграционное тестирование

Интеграционные тесты находятся в папке `tests`

Запуск

```
make test-int
```

### 3. Конфигурация линтера

Конфигурация линтера описана в файле `.golangci.yml`

Запуск

```
make lint
```

```
make fmt
```

## Допущения

#### `POST /team/add`

- Создаёт новую команду с заданным `team_name` и списком `members`.
- Если команда с таким названием уже существует — возвращается ошибка `TEAM_EXISTS`.
- В команде должно быть минимум 2 участника. Иначе — `VALIDATION_ERR`.
- `team_name` должен быть длиной от 2 до 50 символов. При нарушении — `VALIDATION_ERR`.
- Пользователь:
  - Создаётся, если его не было ранее.
  - Если указан пользователь из другой команды — он переносится в новую команду, не пересоздаётся. В случае переноса пользователя обновляется его `team_id`.
  - При переносе можно изменить его `is_active`.
  - Связанные ПР (где он автор или ревьювер) не меняются.

#### `GET /team/get?team_name=X`

- Возвращает информацию о команде по имени `team_name`.
- Если команда отсутствует — ошибка `NOT_FOUND`.

#### `POST /users/setIsActive`

- Меняет флаг `is_active` для пользователя по `user_id`.
- Если пользователь не найден — `NOT_FOUND`.
- При успешном обновлении возвращает обновлённые данные пользователя, включая `team_name`.
- Флаг активности можно менять неограниченное количество раз.
- Связанные ПР (где он автор или ревьювер) не меняются.

#### `GET /users/getReview?user_id=X`

- Получаем все ПР у пользователя с идентификатором `user_id`.

#### `POST /pullRequest/create`

- Создаёт новый Pull Request.
- Требуемые поля:
  - `pull_request_id`
  - `pull_request_name`
  - `author_id`
- Проверки:
  - Если пользователя-автора нет — `NOT_FOUND`.
  - Если PR с таким ID уже существует — `PR_EXISTS`.
- Ревьюверы:
  - Выбираются случайным образом из команды автора.
  - Только активные пользователи.
  - Автор ПР не может быть ревьювером.
  - Назначается доступное количество ревьюверов. Максимум 2, минимум - 0.
- В ответ возвращается объект PR со статусом `OPEN`, датой создания и списком назначенных ревьюверов.

#### `POST /pullRequest/reassign`

- При переназначении ПР случайным образом выбирается 1 новый ревьювер из команды заменяемого пользователя, а не автора ПР.
- Переназначение только на активных пользователей. 
- При переназначении ревьювером никогда не выбирается автор ПР.
- Переназначаться может и активный, и неактивный пользователь.
- Если в команде заменяемого пользователя нет кандидатов для замены, то вернется ошибка.
- Нельзя переназначить при статусе ПР `MERGED`

#### `POST /pullRequest/merge`

- Изменяет `status` ПР с `OPEN` на `MERGED`.
- Если `status` ПР был `MERGED`, то ошибка не вернется и ничего не изменится.